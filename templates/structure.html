{% extends 'base.html' %}

{% block head %}

<title>LIGYSIS results</title>

<script src="/static/js/jmol/jsmol/JSmol.min.js"></script>
<script src="/static/js/jmol/jsmol/js/Jmol2.js"></script>
<script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/js/event_functions.js"></script>

{% endblock %}

{% block main %}

<div class="container">
    <div class="row mb-3">
        <div class="col-lg-7 col-sm-12 box">
            <div class="row justify-content-center box-header" style="background-color: #734A98;">
                <div class="col-3 align-self-center">
                    Button with data-bs-toggle
                </div>
                <div class="col-1 align-self-center">
                    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                        <i class="bi bi-caret-down-square"></i>
                    </button>   
                </div>
            </div>
        
            <hr id="myHr" style="border: 2.5px solid #734A98; margin:0; display: none; opacity: 1;">

            <div class="collapse" id="collapseExample">
                <div class="container text-center">
                    <script src="/static/js/jsmol_applet.js"></script>
                </div>
            </div>


            <!-- <script src="/static/js/jsmol_applet.js"></script> -->
            <script>
                $(document).ready(function(){
                    $('[data-bs-toggle="collapse"]').click(function(){
                        var icon = $(this).find('i.bi');
                        icon.toggleClass('bi bi-caret-down-square bi bi-caret-up-square');
            
                        // Toggle <hr> visibility
                        $("#myHr").toggle();
                    });
                });
            </script>
        </div>
        <div class="col-lg-5 col-sm-12">
            <div class="row mb-3 justify-content-center">
                <table class="table table-bordered table-hover sortable"id="bss_table">
                    <caption>Ligand binding sites and their averaged features</caption>
                    <thead class="fixTableHead">
                        <tr class="table__header">
                            {% for header in headings %}
                            <th class="table__cell">{{ header }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in range(data["lab"]|length) %}
                        <tr class="custom-row" style="color: {{ colors[loop.index0] }} !important;" id="{{ data['lab'][loop.index0] }}">
                                {% for k in data.keys() %}
                                    <td class="table__cell">{{ data[k][i] }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="row mb-2 justify-content-center">
                <canvas id="chartCanvas" width="400" height="300"></canvas>
            </div>
            <div class="row justify-content-evenly">
                <div class="col-2">
                    <select id="xAxisTitle">
                        {% for header in headings[1:] %}
                        <option value="{{ header }}">{{ header }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-2">
                    <select id="yAxisTitle">
                        {% for header in headings[1:] %}
                        <option value="{{ header }}">{{ header }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col">
            <div class="row mb-3 justify-content-center">
                <table class="table table-bordered table-hover sortable" id="bs_ress_table">
                    <thead class="sticky-header">
                        <tr class="table__header">
                            {% for header in cc %}
                            <th class="table__cell">{{ header }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="row mb-2 justify-content-center">
                <canvas id="newChartCanvas" width="650" height="320"></canvas>
            </div>
            <div class="row justify-content-evenly">
                <div class="col-2">
                    <select id="xAxisTitle2" class="axis-dropdown2 x-axis-dropdown2">
                        <option selected hidden>abs_norm_shenkin</option>
                        {% for header in cc[1:] %}
                        <option value="{{ header }}">{{ header }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-2">
                    <select id="yAxisTitle2" class="axis-dropdown2 y-axis-dropdown2">
                        <option selected hidden>oddsratio</option>
                        {% for header in cc[1:] %}
                        <option value="{{ header }}">{{ header }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>

<script> // some variable definitions from the server
    const chartData = {{ data | tojson }}
    const chartColors = {{ colors | tojson }}
    const cc = {{ cc | tojson }}
    const bs_ress_dict = {{ bs_ress_dict | tojson }}
</script>
<script src="/static/js/charts.js"></script>
<script src="/static/js/table_listeners.js"></script>

{% endblock%}